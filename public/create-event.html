<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="create-event" content="width=device-width, initial-scale=1.0" />
    <title>Create Event</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/nav.css" />
    <style>
      @media only screen and (max-width: 600px) {
        /* For mobile phones: */
        [class*="col-"] {
          width: 100%;
        }
        h2 {
          margin-bottom: 2rem;
        }
        form {
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-top: 6rem;
        }

        .line {
          width: 30rem;
        }

        .imgbox {
          align-items: center;
          height: 10rem;
          width: 30rem;
        }

        textarea {
          padding: 10px;
          margin-bottom: 20px;
          border-radius: 5px;
          border: none;
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
          height: 15rem;
        }

        .date {
          width: 15rem;
        }

        input {
          padding: 10px;
          margin-bottom: 20px;
          border-radius: 5px;
          border: none;
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        select {
          padding: 10px;
          margin-bottom: 20px;
          border-radius: 5px;
          border: none;
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        input[type="submit"] {
          background-color: #4aa2ff;
          color: #4f4f4f;
          font-size: 20px;
          padding: 10px 20px;
          border-radius: 5px;
          border: none;
          cursor: pointer;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        input[type="submit"]:hover {
          background-color: #b1d7ff;
        }

        .hash-tag-preview {
          background-color: #ddd;
          color: black;
          padding: 0.5rem;
          border-radius: 0.5rem;
          display: inline-block;
          margin: 0.5rem;
        }
        [hidden] {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <nav
      class="navbar navbar-expand-md mb-4"
      style="background-color: rgb(111, 203, 234)"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="/index.html">
          <img id="logo" src="img/Logo.png" width="60" height="47" />Pecky
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarCollapse"
          aria-controls="navbarCollapse"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav me-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a href="/Login.html" class="nav-link d-flex px-2 text-dark"
                >LogIn</a
              >
              <a href="/sign-up.html" class="nav-link d-flex px-2 text-dark"
                >Sign Up</a
              >
            </li>

            <li class="nav-item">
              <a href="/index.html" class="nav-link px-2 text-dark">Home</a>
            </li>
            <li class="nav-item">
              <a href="/create-event.html" class="nav-link px-2 text-dark"
                >Create event</a
              >
            </li>
            <li class="nav-item">
              <a href="/manage-event.html" class="nav-link px-2 text-dark"
                >Manage event</a
              >
            </li>
            <li class="nav-item">
              <a href="/edit-event.html" class="nav-link px-2 text-dark"
                >Edit event</a
              >
            </li>
          </ul>
          <form id="logout" method="POST" action="/logout">
            <button
              type="submit"
              value="Logout"
              class="btn btn-outline-dark me-2"
            >
              Logout
            </button>
          </form>
        </div>
      </div>
    </nav>
    <form
      id="Create-Event"
      id="createPostForm"
      method="post"
      action="/createEvent"
    >
      <h2>Event Create</h2>
      <div>
        <label for="img"></label>
        <input
          class="imgbox"
          action="/action_page.php"
          type="file"
          name="eventPictures"
          accept="image/*"
        />
      </div>
      <div>
        <input
          class="line"
          type="text"
          placeholder="title"
          name="title"
          required
        />
      </div>
      <div>
        <select
          class="line"
          type="text"
          placeholder="category"
          name="category"
          required
        >
          <option value="Anime">Anime</option>
          <option value="Board Game">Board Game</option>
          <option value="Booking">Booking</option>
          <option value="Celebrities">Celebrities</option>
          <option value="Giveaway">Giveaway</option>
          <option value="Match">Match</option>
          <option value="Meeting">Meeting</option>
          <option value="Photography">Photography</option>
        </select>
      </div>

      <!-- <label>
        <div>
          <input hidden type="text" name="hashtags" />
        </div>
        <div id="hashTagPreviewList">
          <div hidden class="hash-tag-preview">123</div>
        </div>
        <div>
          <input
            type="text"
            class="line"
            id="hashtag"
            list="hashtags"
            placeholder="hashtag"
            name="hashtag"
          />
          <datalist id="hashtags">
            <option>apple</option>
            <option>pie</option>
          </datalist>
        </div>
      </label> -->
      <!-- <input type="submit" value="Submit" />
      <input type="reset" value="Reset" /> -->
      <div>
        <input
          type="text"
          class="line"
          id="hashtag"
          list="hashtags"
          placeholder="Key Description"
          name="hashtag"
          required
        />
      </div>
      <div>
        <input
          class="start_date date"
          type="text"
          placeholder="Start Date"
          name="start_date"
          onfocus="(this.type='date')"
          onblur="(this.type='text')"
          required
        />
        <input
          class="end_date date"
          type="text"
          placeholder="End Date"
          name="end_date"
          onfocus="(this.type='date')"
          onblur="(this.type='text')"
          required
        />
      </div>
      <div>
        <input
          class="line"
          type="time"
          placeholder="Time"
          name="timeslot"
          required
        />
      </div>
      <div>
        <input
          class="line"
          type="number"
          placeholder="Cost in HKD"
          name="cost"
          required
        />
      </div>
      <div>
        <input
          class="line"
          type="text"
          placeholder="Location"
          name="location"
          required
        />
      </div>
      <div>
        <input
          class="line"
          type="number"
          placeholder="Quota"
          name="participants"
          required
        />
      </div>
      <div>
        <textarea
          class="line"
          type="text"
          placeholder="Details"
          name="faq"
          required
        ></textarea>
      </div>
      <div>
        <input type="checkbox" name="is_age18" /> Is age 18 required?
        <input type="checkbox" name="is_private" /> Is it the private event?
      </div>
      <div>
        <input type="submit" id="submitForm" value="Create Event" />
      </div>
    </form>
    <script src="/js/alert.js"></script>
    <script>
      // //加入預示hashtag機制。
      // let form = createPostForm;

      // form.reset();

      // fetch("/tags")
      //   .then((res) => res.json())
      //   .then((json) => {
      //     hashtags.textContent = "";
      //     json.hashtags.forEach((tag) => {
      //       let option = document.createElement("option");
      //       option.textContent =
      //         tag.hashtag.replace(/-/g, " ") + ` (${tag.count})`;
      //       option.value = tag.hashtag;
      //       hashtags.appendChild(option);
      //     });
      //   });

      // hashtag.addEventListener("keypress", (event) => {
      //   switch (event.key) {
      //     case "Enter":
      //     case ",":
      //     case "#":
      //       addHashTag();
      //       event.preventDefault();
      //       break;
      //     default:
      //     // allow normal input
      //   }
      // });

      // function addHashTag() {
      //   let node = document.createElement("div");
      //   node.className = "hash-tag-preview";
      //   node.textContent = hashtag.value;
      //   hashTagPreviewList.appendChild(node);
      //   node.addEventListener("click", () => removeHashTag(node));

      //   if (form.hashtags.value.length > 0) {
      //     form.hashtags.value += ", ";
      //   }
      //   form.hashtags.value += hashtag.value;
      //   hashtag.value = "";
      // }

      // function removeHashTag(node) {
      //   form.hashtags.value = form.hashtags.value
      //     .split(", ")
      //     .filter((part) => part !== node.textContent)
      //     .join(", ");
      //   node.remove();
      // }
      // //加入完畢。

      let today = new Date().toISOString().split("T")[0];
      document.querySelector(".start_date").setAttribute("min", today);
      document.querySelector(".start_date").addEventListener("change", () => {
        let start_date = document.querySelector(".start_date").value;

        document.querySelector(".end_date").setAttribute("min", start_date);
      });

      document
        .querySelector("#Create-Event")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          // Serialize the Form afterwards
          const form = event.target;
          const formData = new FormData(form);
          // Submit FormData(), no need to add "Content-Type": "application/json"
          const res = await fetch("/createEvent", {
            method: "POST",
            body: formData,
          });

          const result = await res.json(); // { success: true }
          window.location = `/view-event.html?id=${result}`;
        });
      async function loadRole() {
        let res = await fetch("/role");
        let json = await res.json();
        if (!json.user) {
          document.body.dataset.role = "guest";
          return;
        }
      }
      loadRole();
    </script>
  </body>
</html>
