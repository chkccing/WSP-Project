<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <title>Edit Event</title>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
    crossorigin="anonymous"
  />
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"
  ></script>

 


    <style>
      @media only screen and (min-width: 380px) {
        /* For mobile phones: */
        [class*="col-"] {
          width: 100%;
        }
      form {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 6rem;
      }
      H2 {
        margin-bottom: 2rem;
      }
      .line {
        width: 87vw;
      }
      .imgbox {
          align-items: center;
          height: 10rem;
          width: 87vw;
        }
      textarea {
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
        border: none;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        height: 40vw;
      }

      .date {
        width: 43vw;
      }

      input {
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
        border: none;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }

      select {
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
        border: none;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }

      input[type="submit"] {
        background-color: rgb(146, 235, 235);
        color: #4d4d4d;
        font-size: 20px;
        padding: 10px 20px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      input[type="submit"]:hover {
        background-color: #0069d9;
      }}
    </style>

<link rel="stylesheet" href="/css/form.css" />
<link rel="stylesheet" href="/css/nav.css" />
  </head>

  <body data-role="guest">
    <nav
    class="navbar mb-4"
    style="background-color: rgb(111, 203, 234)"
  >
    <div class="container-fluid">
      <a class="navbar-brand" href="/index.html">
        <img id="logo" src="img/Logo.png" width="60" height="47" />Pecky
      </a>
      <div class="rowEnd">
        <a
          href="/sign-up.html"
          class="nav-link d-flex px-2 text-dark"
          id="signUp"
          >Sign Up</a
        >/<a
          href="/Login.html"
          class="nav-link d-flex px-2 text-dark"
          id="logIn"
          >LogIn</a
        >          
      </div>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarCollapse"
        aria-controls="navbarCollapse"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <div class="message">
            Welcome back -<span class="username"></span>
          </div>
          <li class="nav-item">
            <a href="/index.html" class="nav-link px-2 text-dark">Home</a>
          </li>
          <li class="nav-item">
            <a href="/create-event.html" class="nav-link px-2 text-dark"
              >Create event</a
            >
          </li>
          <li class="nav-item">
            <a href="/manage-event.html" class="nav-link px-2 text-dark"
              >Manage event</a
            >
          </li>
        </ul>
        <form id="logOut" method="POST" action="/logout" class="nav-item">
          <button
            id="logoutBtn"
            value="Logout"
            class="btn nav-link text-dark me-2"
          >
            Log out
          </button>
        </form>
      </div>
    </div>
  </nav>
    
    <form id="Edit-Event">
      <H2>Edit Your Event</H2>
      <div>
        <label for="img"></label>
        <input
          class="imgbox"
          action="/action_page.php"
          type="file"
          name="eventPictures"
          accept="image/*"
        />
      </div>
      <div>
        <input class = "line" type="text" placeholder="" name="title" id="title" required/>
      </div>
      <div>
        <select class = "line" type="text" placeholder="category" name="category" required>
          <option value="Anime">Anime</option>
          <option value="Board Game">Board Game</option>
          <option value="Booking">Booking</option>
          <option value="Celebrities">Celebrities</option>
          <option value="Giveaway">Giveaway</option>
          <option value="Match">Match</option>
          <option value="Meeting">Meeting</option>
          <option value="Photography">Photography</option>
        </select>
      </div>
      <div>
        <input class = "line" type="text" placeholder="" name="hashtag" id="hashtag" required/>
      </div>
      <div>
        <input class="start_date date" type="text" placeholder="" name ="start_date" id="start_date" onfocus="(this.type='date')" onblur="(this.type='text')">
        <input class="end_date date" type="text" placeholder="" name ="end_date" id="end_date" onfocus="(this.type='date')" onblur="(this.type='text')" >
      </div>
      <div>
        <input class = "line" type="number" placeholder="" name="cost" id="cost" required/>
      </div>
      <div>
        <input class = "line" type="text" placeholder="" name="location" id="location" required/>
      </div>
      <div>
        <input class = "line" type="number" placeholder="" name="participants" id ="participants" required/>
      </div>
      <div>
        <textarea class = "line" type="text" placeholder="" name="faq" id="faq" required></textarea>
      </div>
      <div>
        <input type="checkbox" name="is_age18" /> Is age 18 required?
        <input type="checkbox" name="is_private" /> Is it the private event?
      </div>
      <div>
        <input type="submit" id="submitForm" value="Edit Complete" />
      </div>
    </div> 
    </form>

    <div class="footer">© 2023 Chocolate IceCream Limited</div>
    <script src="/js/alert.js"></script>

    <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"
  ></script>
  
    <script>
      //set start date cannot earlier than today
      let today = new Date().toISOString().split('T')[0];
      document.querySelector(".start_date").setAttribute('min', today);
      document.querySelector(".start_date").addEventListener("change",()=>{

        let start_date = document.querySelector(".start_date").value
     
        document.querySelector(".end_date").setAttribute('min', start_date);

      } )
    
      //insert data to database
      let params = new URL(document.location).searchParams;
      let eventId = params.get("id");
      
      
      document.querySelector("#Edit-Event").addEventListener('submit', async (event)=> {
 
      event.preventDefault();
 

      // Serialize the Form afterwards
      const form = event.target;
      const formData = new FormData(form);


      // Submit FormData(), no need to add "Content-Type": "application/json"
      const res = await fetch(`/editEvent?eventId=${eventId}`, {
        method: "POST",
        body: formData,
      });

      const result = await res.json(); // { success: true }
      window.location = `/view-event.html?id=${result}`
       });

      // insert event details
      async function viewEvent() {
        let res = await fetch(`/viewEvent/${eventId}`);
        let json = await res.json();
        document.querySelector("#title").value = json.data.title;
        document.querySelector("#hashtag").value = json.data.hashtag;
        document.querySelector("#start_date").value = json.data.start_date.split("T")[0];;
        document.querySelector("#end_date").value = json.data.end_date.split("T")[0];;
        document.querySelector("#cost").value =
          json.data.cost;
        document.querySelector("#location").value =
          json.data.location;
        document.querySelector("#participants").value =
          json.data.participants;
        document.querySelector("#faq").value = json.data.faq;


      }
      viewEvent();
      let logoutForm = document.querySelector("form#logOut");
      //連同applyRole令div顯示用戶名稱
      let currentUsername = document.querySelector(".username");

      logoutForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        let form = logoutForm;
        let res = await fetch(form.action, {
          method: form.method,
        });
        let json = await res.json();
        if (json.role == "guest") {
          applyRole();
        }
        window.location = `/index.html`;
      });

      function applyRole(user) {
        document.body.dataset.role = user ? "user" : "guest";
        if (user) {
          currentUsername.textContent = user.name;
        }
      }

      async function loadRole() {
        let res = await fetch("/role");
        let json = await res.json();
        applyRole(json.user);
      }
      loadRole();
    </script>
  </body>
</html>
